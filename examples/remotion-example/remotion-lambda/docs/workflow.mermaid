graph TD
    subgraph "User's Application"
        A[1. User provides Video + Config] --> B(2. Calls renderDynamicVideo)
    end

    subgraph "New @microfox/remotion-lambda Package"
        B --> C{Audio Extraction};
        C -- "Audio File" --> D{Transcription};
        D -- "Words + Timestamps" --> E{AI Analysis & Layout Generation};
        E -- "Final Layout Tree with<br/>Tailwind CSS Classes" --> F{Remotion Renderer};
        F -- "Render Request" --> G{Lambda};
        G -- "Render ID" --> H(3. Returns RenderID);
    end

    subgraph "External APIs"
        D -- "Audio" --> I["<b>API 1:</b><br/>Speech-to-Text<br/>(AssemblyAI)"];
        E -- "Prompts" --> J["<b>API 2:</b><br/>Generative AI<br/>(Anthropic)"];
    end

    H --> K(4. User polls getProgress);
    subgraph "@microfox/remotion-lambda Package"
        K --> G
    end
    G -- "Final URL" --> L(5. Final Video is Ready);

    classDef package fill:#e6f3ff,stroke:#0066cc,stroke-width:2px;
    class C,D,E,F,G,K package;